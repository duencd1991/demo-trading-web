webpackJsonp([29],{1262:function(t,e){},1263:function(t,e){},823:function(t,e,i){"use strict";(function(e,n){function o(t){function i(){o.init(t);var e=TVSettings.getJSON(s.settingsKey,{});o._enabledWidgets.every(function(t){return t!==e.activeWidget})&&(e={})}this.minimized=new e,this.activeWidget=new e,this._widgets={},this._buttons={},this._widgetsProperties={},this.height=new e(this.DEFAULT_HEIGHT),this._actualHeight=new e,this.options=t||{},this.initialized=new n,this._config=t.config;var o=this;o._enabledWidgets=(t&&t.widgets||[]).filter(function(t){return t&&!!o._config[t]}),i()}var a,s;i(1262),i(1263),a=i(28).trackEvent,s=i(402),o.prototype.initWidgetProperties=function(t){var i="bottom"+t+"widget";this._widgetsProperties[t]=new e(TVSettings.getJSON(i,null)),this._widgetsProperties[t].subscribe(function(t){null==t?TVSettings.remove(i):TVSettings.setJSON(i,t)})},o.prototype.activateTradingTab=function(){var t=this;return this.toggleWidget("paper_trading",!0).then(function(){t.getWidgetByName("paper_trading").activate()})},o.prototype.activateScriptEditorTab=function(t){var e=this;return this.toggleWidget("scripteditor",!0).then(function(){e._config.scripteditor.ctor.open(t)})},o.prototype.toggleWidget=function(t,e,i){var n=this;return new Promise(function(o){var s=-1!==n._enabledWidgets.indexOf(t),r=s&&(!0===e&&t||t!==n.activeWidget.value()&&t);n.activeWidget.setValue(r),r&&i&&a("Platform Widgets",i),o()})},o.prototype.minimize=function(){this.activeWidget.setValue(!1)},o.prototype.init=function(t){var i=this;i._enabledWidgets&&i._enabledWidgets.length&&(i._inited||(i._createLayout(i.options.resizerBridge.body.value()),i.activeWidget.subscribe(function(t){i.minimized.setValue(!t)}),i.activeWidget.subscribe(function(){var n,o,a,s,r,d;if(i.minimized.value())i.$container.addClass("js-hidden");else{if(n=i.activeWidget.value(),i._enabledWidgets.every(function(t){return t!==n}))return;i.$container.removeClass("js-hidden").css({height:i._actualHeight.value()}),i.$container.find(".bottom-widgetbar-content").addClass("js-hidden"),i._widgets[n]?(o=i._widgets[n]._$content,o.removeClass("js-hidden")):(o=$(document.createElement("div")).attr("class","bottom-widgetbar-content "+n),o.appendTo(i.$container),i.initWidgetProperties(n),a=new e,i.activeWidget.subscribe(function(t){a.setValue(t===n)},{callWithLast:!0}),s=function(){i.toggleWidget(n,!0)},i._widgets[n]=new i._config[n].ctor({$body:o,height:i._actualHeight,width:i.options.resizerBridge.width,minimized:i.minimized,visible:a.readonly(),properties:i._widgetsProperties[n],activate:s,chartWidgetCollection:t.chartWidgetCollection||null,originalStandalone:"screener"===n,backtestingStrategyDispatcher:i.options.backtestingStrategyDispatcher}),i._widgets[n]._$content=o,r=i._widgets[n],r.disabled&&r.disabled.subscribe(function(t){i.$loadingOverlay.toggleClass("js-hidden",!t)}),i._getWidgetDfd(n).resolve(i._widgets[n]))}d=function(){var t=0;i.minimized.value()||(t=i.height.value()+i.PADDING),i.options.resizerBridge.negotiateHeight({min:i.MIN_HEIGHT,max:t})},
i.height.subscribe(d),i.minimized.subscribe(d),d(),i._save()}),i.height.subscribe(function(t){i._save()}),i.options.resizerBridge.height.subscribe(function(){if(!i.minimized.value()){var t=Math.max(i.options.resizerBridge.height.value()-i.PADDING,0);i._actualHeight.setValue(t),i.$container.css("height",t)}},{callWithLast:!0}),i._registerWidgets(),i._loadState(),t.chartWidgetCollection&&(i._chartWidgetCollection=t.chartWidgetCollection),i._inited=!0,i.initialized.fire()))},o.prototype.widget=null,o.prototype.MIN_HEIGHT=30,o.prototype.DEFAULT_HEIGHT=s.defaultHeight,o.prototype.MINIMIZE_THRESHOLD=10,o.prototype.PADDING=0,o.prototype._getWidgetDfd=function(t){return this._widgetDfds||(this._widgetDfds={}),this._widgetDfds[t]||(this._widgetDfds[t]=$.Deferred()),this._widgetDfds[t]},o.prototype.getWidgetPromiseByName=function(t){return this._getWidgetDfd(t).promise()},o.prototype._createLayout=function(t){var e=this;t[0].innerHTML="",e.$container=$("<div>").attr("id","bottom-area").appendTo(t),e.$handle=$(document.createElement("div")).attr("class","bottom-widgetbar-handle").appendTo(e.$container),e.$handle.on("mousedown touchstart",e._onLayoutResizeHandleMousedown.bind(e)),e.$loadingOverlay=$(document.createElement("div")).attr("class","bottom-widgetbar-loading-overlay js-hidden").appendTo(e.$container)},o.prototype._registerWidgets=function(){var t=this;this._enabledWidgets.forEach(function(e){var i,n=t._config[e];"function"==typeof n.onRegister&&(i=function(){t.toggleWidget(e,!0)},n.onRegister.call(null,{activate:i,name:e}))})},o.prototype._loadState=function(){var t,e=this,i=TVSettings.getJSON(s.settingsKey,{}),n=i.activeWidget;void 0===n&&(n=this.options.defaultActiveWidget||!1),n&&!e._config.hasOwnProperty(n)&&(n=!1),this.activeWidget.setValue(n),t=+i.height,isFinite(t)||(t=e.DEFAULT_HEIGHT),t<e.MIN_HEIGHT&&(t=e.MIN_HEIGHT),this.height.setValue(t)},o.prototype._save=function(){var t=this.activeWidget.value();TVSettings.setJSON(s.settingsKey,{activeWidget:t||null,height:this.height.value()})},o.prototype._onLayoutResizeHandleMousedown=function(t){function e(t){var e,i,r,d;e=t.originalEvent.touches?t.originalEvent.touches[0].clientY:t.pageY,i=e-s,r=n.minimized.value(),d=o-i,d<n.MINIMIZE_THRESHOLD?(d=o,r=!0):r=!1,d=Math.max(d,n.MIN_HEIGHT),isFinite(d)&&(n.minimized.value()!==r?r?(n.toggleWidget(a),n.height.setValue(Math.max(o,n.MIN_HEIGHT))):(n.height.setValue(d),n.toggleWidget(a)):n.height.value()!==d&&n.height.setValue(d))}function i(t){$(document.documentElement).off("mousemove touchmove",e).off("mouseup touchend",i),n._save()}var n,o,a,s;t.isDefaultPrevented()||(t.preventDefault(),n=this,o=n.minimized.value()?0:n.$container.height(),a=n.activeWidget.value(),s=t.originalEvent.touches?t.originalEvent.touches[0].clientY:t.pageY,$(document.documentElement).on("mousemove touchmove",e).on("mouseup touchend",i))},o.prototype.buttons=function(){var t,e;return this._enabledWidgets.length?(t=this,e=$(document.createElement("div")).addClass("botom-toolbar-tabs"),this._enabledWidgets.forEach(function(i){
var n=t._config[i],o=$(document.createElement("span")).addClass("bottom-toolbar-tab apply-common-tooltip "+i+"-tab").attr("title",n.buttonOpenTooltip||"").attr("tabindex",-1).on("click",function(e){e.isDefaultPrevented()||$(e.target).closest('[data-prevent-tab-click]="true"').length||(e.preventDefault(),t.toggleWidget(i,!1,n._gaEvent))});n.customTitleComponent?ReactDOM.render(React.createElement(n.customTitleComponent,{activationCallback:function(){i!==t.activeWidget.value()&&t.toggleWidget(i,!1,n._gaEvent)}}),o[0]):$(document.createElement("span")).addClass("title").text(n.title||i).appendTo(o),TradingView.bottomWidgetBar.activeWidget.subscribe(function(e){o.toggleClass("active",e===i),t.updateButtonTooltip(i)},{callWithLast:!0}),"function"==typeof n.onTabShow&&n.onTabShow.call(null,{$button:o}),n.beta&&o.addClass("bottom-toolbar-tab--beta"),o.appendTo(e),t._buttons[i]=o}),e):$()},o.prototype.getWidgetByName=function(t){return this._widgets[t]||null},o.prototype.getButtonByName=function(t){return this._buttons[t]||null},o.prototype.updateButtonTooltip=function(t){var e=$(this.getButtonByName(t)),i=this._config[t],n=e.hasClass("active")?i.buttonCloseTooltip:i.buttonOpenTooltip;e.attr("title",n)},o.prototype.isWidgetEnabled=function(t){return this._enabledWidgets.includes(t)},o.prototype.destroy=function(){if(this._enabledWidgets.length){var t=this;this._enabledWidgets.forEach(function(e){t._config[e].customTitleComponent&&ReactDOM.unmountComponentAtNode(t._buttons[e][0])})}},t.exports.Bottomwidgetbar=o}).call(e,i(15),i(8))}});